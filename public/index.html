<!DOCTYPE html>
<html>
<head>
  <title>Minecraft Server Manager</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
    .server { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
    input, button { margin: 5px; padding: 8px; }
    .controls { margin-top: 10px; }
    .start-btn { background: #28a745; color: white; border: none; cursor: pointer; }
    .stop-btn { background: #ffc107; color: black; border: none; cursor: pointer; margin: 0 5px; }
    .delete-btn { background: #dc3545; color: white; border: none; cursor: pointer; }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    #error { color: red; margin: 10px 0; }
    #success { color: green; margin: 10px 0; }
  </style>
</head>
<body>
  <h1>Minecraft Server Manager</h1>
  <div id="error"></div>
  <div id="success"></div>
  
  <div id="serverList"></div>

  <h2>Create New Server</h2>
  <form id="createForm">
    <input type="text" name="name" placeholder="Server Name" required>
    <input type="number" name="port" placeholder="Port" value="25565" required>
    <button type="submit" class="create-btn">Create Server</button>
  </form>

  <script>
    async function refreshServers() {
      try {
        const response = await fetch('/api/servers');
        if (!response.ok) throw new Error('Failed to load servers');
        const servers = await response.json();
        
        document.getElementById('serverList').innerHTML = servers
          .map(server => `
            <div class="server">
              <h3>${server.name}</h3>
              <p>Folder: ${server.folder_name}</p>
              <p>Port: ${server.port}</p>
              <p>Status: <span class="status">${server.status}</span></p>
              <div class="controls">
                <button class="start-btn" 
                  onclick="controlServer('${server.id}', 'start')"
                  ${server.status === 'running' ? 'disabled' : ''}>
                  Start
                </button>
                <button class="stop-btn" 
                  onclick="controlServer('${server.id}', 'stop')"
                  ${server.status !== 'running' ? 'disabled' : ''}>
                  Stop
                </button>
                <button class="delete-btn" onclick="deleteServer('${server.id}')">
                  Delete
                </button>
              </div>
            </div>
          `).join('');
      } catch (err) {
        showError(err.message);
      }
    }

    async function controlServer(serverId, action) {
      try {
        const response = await fetch(`/api/servers/${serverId}/${action}`, {
          method: 'POST'
        });
        
        if (!response.ok) throw new Error(`Failed to ${action} server`);
        
        showSuccess(`Server ${action} command sent`);
        setTimeout(refreshServers, 2000);
      } catch (err) {
        showError(err.message);
      }
    }

    async function deleteServer(serverId) {
      if (confirm('Are you sure you want to delete this server?')) {
        try {
          await fetch(`/api/servers/${serverId}`, { method: 'DELETE' });
          showSuccess('Server deleted successfully');
          refreshServers();
        } catch (err) {
          showError(err.message);
        }
      }
    }

    document.getElementById('createForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = {
        name: formData.get('name'),
        port: formData.get('port')
      };

      try {
        const response = await fetch('/api/servers', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        if (!response.ok) throw new Error('Server creation failed');
        showSuccess('Server created successfully!');
        e.target.reset();
        refreshServers();
      } catch (err) {
        showError(err.message);
      }
    });

    function showError(message) {
      const errorDiv = document.getElementById('error');
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
      setTimeout(() => errorDiv.style.display = 'none', 5000);
    }

    function showSuccess(message) {
      const successDiv = document.getElementById('success');
      successDiv.textContent = message;
      successDiv.style.display = 'block';
      setTimeout(() => successDiv.style.display = 'none', 5000);
    }

    // Initial load
    refreshServers();
  </script>
</body>
</html>