<!DOCTYPE html>
<html>
<head>
  <title>Minecraft Server Manager</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      padding: 20px; 
      max-width: 800px; 
      margin: 0 auto; 
    }
    
    .server {
      border: 1px solid #ddd;
      padding: 15px;
      margin: 10px 0;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .server:hover {
      background-color: #f5f5f5;
    }
    
    input, button { 
      margin: 5px; 
      padding: 8px; 
    }
    
    button { 
      background: #007bff; 
      color: white; 
      border: none; 
      cursor: pointer; 
    }
    
    #error { 
      color: red; 
      margin: 10px 0; 
    }
    
    #success { 
      color: green; 
      margin: 10px 0; 
    }
    
    .status {
      font-weight: bold;
      color: #666;
    }
    
    .status.running {
      color: #28a745;
    }
    
    .status.stopped {
      color: #dc3545;
    }
  </style>
</head>
<body>
  <h1>Minecraft Server Manager</h1>
  <div id="error"></div>
  <div id="success"></div>
  
  <div id="serverList"></div>

  <h2>Create New Server</h2>
  <form id="createForm">
    <input type="text" name="name" placeholder="Server Name" required>
    <input type="number" name="port" placeholder="Port" value="25565" required>
    <button type="submit">Create Server</button>
  </form>

  <script>
    async function refreshServers() {
      try {
        const response = await fetch('/api/servers');
        if (!response.ok) throw new Error('Failed to load servers');
        const servers = await response.json();
        
        document.getElementById('serverList').innerHTML = servers
          .map(server => `
            <div class="server" onclick="window.location.href='/server.html?id=${server.id}'">
              <h3>${server.name}</h3>
              <p>Folder: ${server.folder_name}</p>
              <p>Port: ${server.port}</p>
              <p>Status: <span class="status ${server.status}">${server.status}</span></p>
            </div>
          `).join('');
      } catch (err) {
        showError(err.message);
      }
    }

    document.getElementById('createForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = {
        name: formData.get('name'),
        port: formData.get('port')
      };

      try {
        const response = await fetch('/api/servers', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        if (!response.ok) throw new Error('Server creation failed');
        showSuccess('Server created successfully!');
        e.target.reset();
        refreshServers();
      } catch (err) {
        showError(err.message);
      }
    });

    function showError(message) {
      const errorDiv = document.getElementById('error');
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
      setTimeout(() => errorDiv.style.display = 'none', 5000);
    }

    function showSuccess(message) {
      const successDiv = document.getElementById('success');
      successDiv.textContent = message;
      successDiv.style.display = 'block';
      setTimeout(() => successDiv.style.display = 'none', 5000);
    }

    // Initial load
    refreshServers();
  </script>
</body>
</html>